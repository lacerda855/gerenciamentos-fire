<!DOCTYPE html>
<html lang="en">                                    
<head>                                            
    <meta charset="UTF-8">                        
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cocontainerde.jquery.com/jquery-3.6.4.min.js"></script>
  <link rel="stylesheet" href="style.css">
    <title>Gerenciamento de dados Usuario</title>
</head>
<body>                                           
   
<div class="container">
<h1 class="text"> Gerenciamento de dados Usuario</h1>
</div>
  <div class="container mt-4">
 <!-- Formul√°rio -->
    <div class="formulario">
      <div class="card-body">
        <h4 id="form-title" class="mb-3">Cadastrar Usu√°rio</h4>
        <form id="usuarioForm">
          <input type="hidden" id="usuarioId">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="nome" class="form-label">Nome:</label>
              <input type="text" id="nome" class="form-control" placeholder="Digite o nome" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="senha" class="form-label">Senha:</label>
              <input type="password" id="senha" class="form-control" placeholder="Digite a senha" required>
            </div>
          </div>
        </form>
      </div>
    </div>
<div class="d-flex justify-content-center">
    <button onclick =" AdicionarUsuario()">Adicionar Usuario</button>
    </div>
</form>
</div>
<br>
<!-- Tabela -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h4>Lista de Usu√°rios</h4>
        <table class="table table-striped mt-3" id="tabelaUsuarios">
          <thead class="table-primary">
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Senha</th>
              <th class="text-center">A√ß√µes</th>
            </tr>
          </thead>
        
        </table>
      </div>
    </div>

    <div id="alerta" class="mt-4"></div>
  </div>
  <script>
 const API_URL = 'http://localhost:3000/usuarios';
   $(".formulario").ready(() => {
      carregarUsuarios();


      let listadeUsuarios = [];
      console.log(listadeUsuarios)
      function AdicionarUsuario() {
        let entrada = document.getElementById("entrada").value;
        listadeUsuarios.push(entrada);
        console.log(listadeUsuarios);
      }
      function carregarUsuarios() {
        $.get(API_URL)
          .done(data => {
            const body = $("#tabelaUsuarios tbody");
            body.empty();
            if (data.length === 0) {
              body.append(`<tr><td colspan="4" class="text-center text-muted">Nenhum usu√°rio cadastrado.</td></tr>`);
            } else {
              data.forEach(u => {
                body.append(`
                  <tr>
                    <td>${u.id}</td>
                    <td>${u.nome}</td>
                    <td>${u.senha}</td>
                    <td class="text-center">
                      <button class="btn btn-warning btn-sm editar" data-id="${u.id}">‚úèÔ∏è Editar</button>
                      <button class="btn btn-danger btn-sm excluir" data-id="${u.id}">üóëÔ∏è Excluir</button>
                    </td>
                  </tr>
                `);
              });
            }
          })
          .fail(err => {
            mostrarAlerta("Erro ao carregar usu√°rios: " + err.responseJSON?.error, "danger");
          });
      }

      $("#usuarioForm").on("submit", e => {
        e.preventDefault();
        const id = $("#usuarioId").val();
        const usuario = {
          nome: $("#nome").val(),
          senha: $("#senha").val()
        };
        const metodo = id ? "PUT" : "POST";
        const url = id ? `${API_URL}/${id}` : API_URL;

        $.ajax({
          url,
          method: metodo,
          data: JSON.stringify(usuario),
          contentType: "application/json"
        })
        .done(() => {
          carregarUsuarios();
          resetarFormulario();
          mostrarAlerta(`Usu√°rio ${id ? "atualizado" : "cadastrado"} com sucesso!`, "success");
        })
        .fail(err => mostrarAlerta("Erro ao salvar: " + err.responseJSON?.detalhes, "danger"));
      });

      $(document).on("click", ".editar", function() {
        const id = $(this).data("id");
        $.get(`${API_URL}/${id}`)
          .done(usuario => {
            $("#usuarioId").val(usuario.id);
            $("#nome").val(usuario.nome);
            $("#senha").val(usuario.senha);
            $("#form-title").text("Editar Usu√°rio");
            $("#btnSalvar").text("Atualizar");
            $("#btnCancelar").removeClass("d-none");
          });
      });

      $(document).on("click", ".excluir", function() {
        const id = $(this).data("id");
        if (confirm("Deseja realmente excluir este usu√°rio?")) {
          $.ajax({ url: `${API_URL}/${id}`, method: "DELETE" })
            .done(() => {
              carregarUsuarios();
              mostrarAlerta("Usu√°rio exclu√≠do com sucesso!", "success");
            })
            .fail(err => mostrarAlerta("Erro ao excluir: " + err.responseJSON?.error, "danger"));
        }
      });

      $("#btnCancelar").click(resetarFormulario);

      function resetarFormulario() {
        $("#usuarioForm")[0].reset();
        $("#usuarioId").val("");
        $("#form-title").text("Cadastrar Usu√°rio");
        $("#btnSalvar").text("Salvar");
        $("#btnCancelar").addClass("d-none");
      }

      function mostrarAlerta(msg, tipo) {
        $("#alerta").html(`
          <div class="alert alert-${tipo} alert-dismissible fade show" role="alert">
            ${msg}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        `);
        setTimeout(() => $(".alert").alert("close"), 3000);
      }
    });
  </script>
</body>                                          
</html> 
